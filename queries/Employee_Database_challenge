select sum(count)
from dept_retire;

select dr.count, d.dept_name, e.first_name, e.last_name, t.title

-- Dept manager
select dr.count, d.dept_name, e.first_name, e.last_name, t.title
-- into dept_manager_retire_count
from dept_retire dr
	inner join dept_manager dm
		on (dr.dept_no = dm.dept_no)
	left join employees e
		on (dm.emp_no = e.emp_no)
	INNER JOIN departments d
        ON (dr.dept_no = d.dept_no)
	inner join titles t
		on (e.emp_no = t.emp_no)
where 
	dm.to_date = '9999-01-01'
	and t.to_date = '9999-01-01'
group by dr.count, d.dept_name, e.first_name, e.last_name, t.title;

--count retiring employees who have been promoted
SELECT emp_no, COUNT(emp_no)
into retire_promotions
FROM retirement_titles 
GROUP BY emp_no 
HAVING COUNT(emp_no) > 1;


--
SELECT  e.emp_no,
        e.last_name,
        e.first_name,
		t.title,
        t.from_date,
        t.to_date
-- INTO retirement_titles
FROM employees e 
    INNER JOIN titles t
        ON (e.emp_no = t.emp_no)
where 
	e.birth_date >= '1/1/1952'
	and e.birth_date <= '12/31/1955'
order by emp_no;




--count all duplicate titles
SELECT e.emp_no, COUNT(e.emp_no)
into promotions
FROM employees e 
    INNER JOIN titles t
        ON (e.emp_no = t.emp_no)
GROUP BY e.emp_no 
-- order by COUNT(e.emp_no) desc,
HAVING COUNT(e.emp_no) > 1;

SELECT *
FROM employees e 
    INNER JOIN titles t
        ON (e.emp_no = t.emp_no)
where e.emp_no = '436574'
	or e.emp_no = '436566';



-- Use Dictinct with Orderby to remove duplicate rows
SELECT 
	distinct on (emp_no) emp_no,
        last_name,
        first_name,
		title
-- INTO unique_titles
FROM retirement_titles
where 
	to_date = '9999-01-01'
order by emp_no,
		to_date desc;
		
-- Add up retirees by title
select
	count (*) as num,
	title
-- into retiring_titles
from 
	unique_titles
group by title
order by num desc;

-- Find potential mentorship candidates
SELECT  
		distinct on (e.emp_no) e.emp_no,
        e.last_name,
        e.first_name,
		e.birth_date,
		d.from_date,
		t.to_date,
        t.title
INTO mentorship_eligibilty
FROM employees e 
	inner join dept_emp d
		ON (e.emp_no = d.emp_no)
    INNER JOIN titles t
        ON (e.emp_no = t.emp_no)
where 
	t.to_date = '9999-01-01'
	and e.birth_date >= '1/1/1965'
	and e.birth_date <= '12/31/1965'
order by emp_no;